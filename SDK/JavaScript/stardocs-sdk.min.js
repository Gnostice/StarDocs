/* 
 * Gnostice StarDocs
 * Copyright Â© Gnostice Information Technologies Private Limited, Bangalore, India
 * http://www.gnostice.com
 * 
*/
"use strict"
!function(){setTimeout(function(e){if("test"!==e){var t=window.setTimeout
window.setTimeout=function(e,s){var r=Array.prototype.slice.call(arguments,2)
return t(e instanceof Function?function(){e.apply(null,r)}:e,s)}}},0,"test")
var e=setInterval(function(t){if(clearInterval(e),"test"!==t){var s=window.setInterval
window.setInterval=function(e,t){var r=Array.prototype.slice.call(arguments,2)
return s(e instanceof Function?function(){e.apply(null,r)}:e,t)}}},0,"test")}()
var Gnostice=Gnostice||{}
Gnostice.ConnectionInfo=function(e,t,s,r,o){this.apiServerVersion="2.0.0",this.apiServerUrl=e||"",this.apiKey=t,this.apiSecret=s,this.serverTimeout=r||-1,this.docOperationTimeout=o||-1},Gnostice.ConnectionInfo.prototype.constructor=Gnostice.ConnectionInfo,Gnostice.DocPasswordSettings=function(e){this.forceFullPermission=e},Gnostice.DocPasswordSettings.prototype=Gnostice.DocPasswordSettings,Gnostice.Preferences=function(e){this.docPasswordSettings=e||new Gnostice.DocPasswordSettings(!1)},Gnostice.Preferences.prototype.constructor=Gnostice.Preferences,Gnostice.StarDocs=function(e,t){this.connectionInfo=e||new Gnostice.ConnectionInfo,this.preferences=t||new Gnostice.Preferences,this.urlSegAuthToken="/auth/token",this.urlSegDocs="/docs",this.urlSegDocsOps="/docs/ops",this.urlSegOps="/ops",this.urlSegInfo="/info",this.urlSegSearchText="/search-text",this.urlSegRedactText="/redact-text",this.urlSegMetaTags="/meta/tags",this.urlSegMetaOwner="/meta/owner",this.urlSegMetaFilename="/meta/filename",this.urlSegUsers="/users",this.urlSegViewSessions="/viewsessions",this.urlSegMiscTags="/misc/tags",this.urlSegMiscGroups="/misc/groups",this.urlMiscPhysicalStores="/misc/physicalstores",this.urlMiscDocumenTreeViews="/misc/documenttreeviews",this.pollInterval=1e3,this.pollRetryMaxCount=600,this.documentPassword=null,this.setDocumentPassword=function(e){this.documentPassword=e},this.viewSessionId=null,this.setViewSessionId=function(e){this.viewSessionId=e}
var s=function(e){this.starDocs=e,this.accessToken=null,this.loggedInUserName=null,this.grantType=null}
s.prototype.constructor=s,s.prototype.loginUser=function(e,t){this.loggedInUserName=null,this.grantType=null
var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken
console.log("In Auth.login: "+e)
var r,o=this
return r=window.btoa?"Basic "+btoa(o.starDocs.connectionInfo.apiKey+":"+o.starDocs.connectionInfo.apiSecret):"Basic "+jQuery.base64.encode(o.starDocs.connectionInfo.apiKey+":"+o.starDocs.connectionInfo.apiSecret),$.ajax({url:s,type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",r)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"password",username:e,password:t}}).then(function(e,t,s){if("success"==t)return o.setAccessToken(e.access_token,"password"),$.Deferred().resolve(e).promise()},function(e,t,s){return o.setAccessToken(null,null),$.Deferred().reject(e.status,s,e.responseJSON).promise()})},s.prototype.loginApp=function(e){this.loggedInUserName=null,this.grantType=null
var t=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken
null!=e&&(t+="?entity_id="+e),console.log("In loginApp")
var s,r=this
return s=window.btoa?"Basic "+btoa(r.starDocs.connectionInfo.apiKey+":"+r.starDocs.connectionInfo.apiSecret):"Basic "+jQuery.base64.encode(r.starDocs.connectionInfo.apiKey+":"+r.starDocs.connectionInfo.apiSecret),$.ajax({url:t,type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization",s)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"client_credentials"}}).then(function(e,t,s){if("success"==t)return r.setAccessToken(e.access_token,"client_credentials"),$.Deferred().resolve(e).promise()},function(e,t,s){return r.setAccessToken(null,null),$.Deferred().reject(e.status,s,e.responseJSON).promise()})},s.prototype.setAccessToken=function(e,t){this.accessToken=e,null!==t&&(this.grantType=t)}
var r=function(e){this.starDocs=e}
r.prototype.constructor=r,r.prototype.upload=function(e,t,s){console.log("Uploading "+e)
var r=new FormData
r.append("fileUpload",e),null!=t&&r.append("password",t),r.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission),s&&null!=this.starDocs.viewSessionId&&r.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
var o=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs
return this.starDocs.doAjaxWithBody("POST",o,r).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.uploadFromURL=function(e,t,s){console.log("Uploading "+e)
var r=new FormData
r.append("fileURL",e),null!=t&&r.append("password",t),r.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission),s&&null!=this.starDocs.viewSessionId&&r.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
var o=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs
return this.starDocs.doAjaxWithBody("POST",o,r).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.copyFrom=function(e,t){return this.uploadFromURL(e,t)},r.prototype.listFiles=function(e,t,s){var r=[]
e="all",e=e.toLowerCase(),r.push("sub_set="+e),$.isArray(s)?Array.prototype.push.apply(r,s):null!=s&&r.push(s)
var o=""
o=$.isArray(t)?t.join():t||"",r.push("include_details="+o)
for(var n=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs,i=0;i<r.length;++i)0===i&&(n+="?"),n+=r[i],i<r.length&&(n+="&")
return this.starDocs.doAjax("GET",n).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.download=function(e,t){if(console.log("Downloading "+e),"boolean"!=typeof t&&(t=!0),t){var s=e
return null!==this.starDocs.auth.accessToken&&(s+="?bearer_token="+this.starDocs.auth.accessToken),console.log("url: "+s),$.Deferred().resolve(window.open(s,"_blank")).promise()}return this.starDocs.doAjax("GET",e,"text").then(function(e,t,s){return $.Deferred().resolve(s.responseText).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.getDownloadUrl=function(e){var t=new URI(e)
return null===this.starDocs.auth.accessToken?$.Deferred().reject(401,"You need to authenticate before calling this method.").promise():(t=t.setQuery("bearer_token",this.starDocs.auth.accessToken),$.Deferred().resolve(t).promise())},r.prototype.delete=function(e){return console.log("Deleting "+e),this.starDocs.doAjax("DELETE",e).then(function(e,t,s){return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.setTags=function(e,t){console.log("Setting tags on  "+e)
var s=e+this.starDocs.urlSegMetaTags,r=JSON.stringify({tags:t})
return this.starDocs.doAjaxWithBody("POST",s,r,"application/json; charset=utf-8").then(function(e,t,s){return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.updateOwner=function(e,t,s,r){console.log("Updating owner for "+e)
var o=e+this.starDocs.urlSegMetaOwner,n={user:{userNameEmail:t}}
null!==s&&(n.resetSharing=s),null!==r&&(n.retainRights=r)
var i=JSON.stringify(n)
return this.starDocs.doAjaxWithBody("PUT",o,i,"application/json; charset=utf-8").then(function(e,t,s){return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},r.prototype.rename=function(e,t){console.log("Updating filename for "+e)
var s=e+this.starDocs.urlSegMetaFilename,r={fileName:t},o=JSON.stringify(r)
return this.starDocs.doAjaxWithBody("PUT",s,o,"application/json; charset=utf-8").then(function(e,t,s){if("success"==t)return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})}
var o=function(e){this.starDocs=e}
o.prototype.constructor=o,o.prototype.merge=function(e,t,s){for(var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/merge",o={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]},n=0;n<e.length;++n){var i={url:e[n]}
null!=t&&(i.password=t[n]),null!=s&&(i.pageRange=s[n]),o.documents.push(i)}var c=JSON.stringify(o)
return this.starDocs.doAjaxWithBodyAndPoll("POST",r,c,"application/json; charset=utf-8")},o.prototype.splitRange=function(e,t,s){var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-range",o={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,pageRanges:[]}]}
null!=t&&(o.documents[0].password=passwords),null!=s&&(o.documents[0].pageRanges=s)
var n=JSON.stringify(o)
return this.starDocs.doAjaxWithBodyAndPoll("POST",r,n,"application/json; charset=utf-8")},o.prototype.splitSeparatorPage=function(e,t){var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-separator",r={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,separatorType:"emptyPage"}]}
null!=t&&(r.documents[0].password=passwords)
var o=JSON.stringify(r)
return this.starDocs.doAjaxWithBodyAndPoll("POST",s,o,"application/json; charset=utf-8")},o.prototype.convertToBMP=function(e,t,s,r){return this.convertToImage("convert-bmp",e,t,s,r)},o.prototype.convertToGIF=function(e,t,s,r){return this.convertToImage("convert-gif",e,t,s,r)},o.prototype.convertToJPEG=function(e,t,s,r){return this.convertToImage("convert-jpeg",e,t,s,r)},o.prototype.convertToPNG=function(e,t,s,r){return this.convertToImage("convert-png",e,t,s,r)},o.prototype.convertToTIFF=function(e,t,s,r,o){return this.convertToImage("convert-tiff",e,t,s,r,o)},o.prototype.convertToMTIFF=function(e,t,s,r,o,n){return this.convertToImage("convert-mtiff",t,s,r,o,n,e)},o.prototype.convertToPDF=function(e,t,s,r,o,n){return this.convertToImage("convert-pdf",t,s,r,null,null,e,o,n)},o.prototype.encrypt=function(e,t,s,r,o,n){var i=e+this.starDocs.urlSegOps+"/encrypt",c={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(c.password=passwords),null!=s&&(c.encryptionLevel=s),null!=r&&(c.newOpenPassword=r),null!=o&&(c.newPermissionsPassword=o),null!=n&&(c.newPermissions=n)
var a=JSON.stringify(c)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",i,a,"application/json; charset=utf-8")},o.prototype.searchText=function(e,t,s,r,o,n){var i=new URI(e).segment(this.starDocs.urlSegOps+this.starDocs.urlSegSearchText).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
if(null!=t?i=i.setQuery("password",t):null!=this.starDocs.documentPassword&&(i=i.setQuery("password",this.starDocs.documentPassword)),null!=s&&""!=s&&(i=i.setQuery("page_range",s)),null!=r&&(i=i.setQuery("mode",r)),null!=o&&o instanceof Array)for(var c=0;c<o.length;++c){var a=o[c]
if(null!=a.text&&""!=a.text){var u=!0===a.caseSensitive,l=!0===a.wholeWord,d="text"
u&&l?d="text_case_word":u&&!l?d="text_case":!u&&l&&(d="text_word"),i=i.setQuery(d,a.text)}}return null!=n&&"object"==typeof n&&(!1===n.pageText&&(i=i.setQuery("scope_page_text",!1)),!0===n.pageImages&&(i=i.setQuery("scope_page_images",!0)),!0===n.bookmarks&&(i=i.setQuery("scope_bookmarks",!0)),!0===n.bookmarkActions&&(i=i.setQuery("scope_bookmark_actions",!0)),!0===n.annotations&&(i=i.setQuery("scope_annotations",!0)),!0===n.annotationActions&&(i=i.setQuery("scope_annotation_actions",!0)),!0===n.documentProperties&&(i=i.setQuery("scope_document_properties",!0))),this.starDocs.doAjaxAndPoll("GET",i.toString())},o.prototype.redactText=function(e,t,s,r,o,n,i,c,a){var u=e+this.starDocs.urlSegOps+this.starDocs.urlRedactText,l={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(l.password=passwords),null!=s&&(l.pageRange=s),null!=r&&(l.searchMode=r),null!=o&&(l.searchText=o),null!=n&&(l.removeAssociatedAnnotations=n),null!=i&&(l.fillSettings=i),null!=c&&(l.includeAdditionalItems=c),null!=a&&(l.cleanupSettings=a)
var d=JSON.stringify(l)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",u,d,"application/json; charset=utf-8")},o.prototype.fillForm=function(e,t,s,r){var o=e+this.starDocs.urlSegOps+"/fill-form",n={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t&&(n.password=t),null!=s&&(n.fields=s),!0===r&&(n.flattenAllFields=r)
var i=JSON.stringify(n)
return this.starDocs.doAjaxWithBodyAndPoll("PUT",o,i,"application/json; charset=utf-8")},o.prototype.convertToImage=function(e,t,s,r,o,n,i,c,a){for(var u=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/"+e,l={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]},d=0;d<t.length;++d){var p={url:t[d]}
null!=s&&(p.password=s[d]),null!=r&&(p.pageRange=r[d]),l.documents.push(p)}null!=o&&(l.imageEncoderSettings=o),null!=n&&(l.tiffCompressionType=n),null!=i&&(l.conversionMode=i),null!=c&&(l.pdfEncoderSettings=c),null!=a&&(l.digitizerSettings=a)
var f=JSON.stringify(l)
return this.starDocs.doAjaxWithBodyAndPoll("POST",u,f,"application/json; charset=utf-8")},o.prototype.getDocInfo=function(e,t){var s=new URI(e).segment(this.starDocs.urlSegInfo).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?s=s.setQuery("password",t):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())},o.prototype.getDocBookmarks=function(e,t){var s=new URI(e).segment("bookmarks").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?s=s.setQuery("password",t):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())},o.prototype.getPageImage=function(e,t,s){t=t||{}
var r=new URI(e).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t.dpi&&(r=r.setQuery("dpi",t.dpi)),null!=t.renderFormFields&&(r=r.setQuery("render-form-fields",t.renderFormFields)),null!=s?r=r.setQuery("password",s):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())},o.prototype.getPageThumbnail=function(e,t,s){t=t||{}
var r=new URI(e).segment("thumbnail").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t.dpi&&(r=r.setQuery("dpi",t.dpi)),null!=t.renderFormFields&&(r=r.setQuery("render-form-fields",t.renderFormFields)),null!=s?r=r.setQuery("password",s):null!=this.starDocs.documentPassword&&(r=r.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",r.toString())},o.prototype.getDocumentPrintImageURLs=function(e,t){var s=new URI(e).segment(this.starDocs.urlSegOps).segment("prepare-print-images"),r={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission}
null!=t?r.password=passwords:null!=this.starDocs.documentPassword&&(r.password=this.starDocs.documentPassword)
var o=JSON.stringify(r),n=$.Deferred(),i=this
return this.starDocs.doAjaxWithBodyAndPoll("POST",s.toString(),o,"application/json; charset=utf-8").done(function(t){console.log("In getDocumentPrintImageURLs: Pages ready "+t)
for(var s=[],r=t.largestRenderedPageCount,o=new URI(e).segment("pages"),c=1;c<=r;++c){var a=o.toString()+"/"+c+"/image",u=new URI(a).setQuery("bearer_token",i.starDocs.auth.accessToken).toString()
s.push(u)}n.resolve(s)}).fail(function(e,t,s){console.log("In getDocumentPrintImageURLs: fail event called"),n.reject(e,t,s)}),n.promise()},o.prototype.getPageFormFields=function(e,t){var s=new URI(e).segment("formfields").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?s=s.setQuery("password",t):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())},o.prototype.getPageText=function(e,t){var s=new URI(e).segment("text").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission)
return null!=t?s=s.setQuery("password",t):null!=this.starDocs.documentPassword&&(s=s.setQuery("password",this.starDocs.documentPassword)),this.starDocs.doAjaxAndPoll("GET",s.toString())}
var n=function(e){this.starDocs=e}
n.prototype.constructor=n,n.prototype.listUsers=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers
return this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},n.prototype.getUserDetails=function(e){return e=e||this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers+"/me",this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})}
var i=function(e){this.starDocs=e}
i.prototype.constructor=i,i.prototype.createView=function(e,t,s){console.log("Creating viewer for doc "+e)
var r=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegViewSessions
s=s||{},t=t||""
var o=JSON.stringify({forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:e,password:t}],viewerSettings:s})
return this.starDocs.doAjaxWithBody("POST",r,o,"application/json; charset=utf-8").then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})}
var c=function(e){this.starDocs=e}
c.prototype.constructor=c,c.prototype.getLookupTags=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscTags
return this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.listGroups=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscGroups
return this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.listPhysicalStores=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscPhysicalStores
return this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.listDocumentTreeViews=function(){var e=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews
return this.starDocs.doAjax("GET",e).then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.createDocumentTreeView=function(e,t){var s=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews,r=JSON.stringify({documentTreeView:{name:e,tagKeys:t}})
return this.starDocs.doAjaxWithBody("POST",s,r,"application/json; charset=utf-8").then(function(e,t,s){return $.Deferred().resolve(e).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.editDocumentTreeView=function(e,t,s){var r=JSON.stringify({documentTreeView:{name:t,tagKeys:s}})
return this.starDocs.doAjaxWithBody("PUT",e,r,"application/json; charset=utf-8").then(function(e,t,s){return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},c.prototype.deleteDocumentTreeView=function(e){return console.log("Deleting "+e),this.starDocs.doAjax("DELETE",e).then(function(e,t,s){return $.Deferred().resolve().promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},this.auth=new s(this),this.storage=new r(this),this.docOperations=new o(this),this.userMgmt=new n(this),this.viewer=new i(this),this.misc=new c(this)},Gnostice.StarDocs.prototype.constructor=Gnostice.StarDocs,Gnostice.StarDocs.prototype.assertUserLogin=function(){if(null===this.auth.accessToken)throw new Error("Authentication required")},Gnostice.StarDocs.prototype.doAjax=function(e,t,s){var r=this
return $.ajax({url:t,type:e,dataType:s||"json",beforeSend:function(e){null!==r.auth.grantType&&null!==r.auth.accessToken&&e.setRequestHeader("Authorization","Bearer "+r.auth.accessToken)},contentType:!1,cache:!1,processData:!1})},Gnostice.StarDocs.prototype.doAjaxWithBody=function(e,t,s,r,o){var n=this
return $.ajax({url:t,type:e,dataType:o||"json",beforeSend:function(e){null!==n.auth.grantType&&null!==n.auth.accessToken&&e.setRequestHeader("Authorization","Bearer "+n.auth.accessToken)},data:s,contentType:r||!1,cache:!1,processData:!1})},Gnostice.StarDocs.prototype.doAjaxAndPoll=function(e,t,s){var r=this.doAjax(e,t,s),o=this
return r.then(function(e,t,s){if(200===s.status)return $.Deferred().resolve(e).promise()
if(202===s.status){var r=$.Deferred(),n=new URI(s.getResponseHeader("location"))
return o.preferences.docPasswordSettings.forceFullPermission&&(n=n.setQuery("force-full-permission",!0)),null!=o.documentPassword&&(n=n.setQuery("password",o.documentPassword)),setTimeout(o.doPoll,o.pollInterval,n.toString(),r,o,1),r.promise()}return $.Deferred().reject(s.status,t,s.responseJSON).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},Gnostice.StarDocs.prototype.doAjaxWithBodyAndPoll=function(e,t,s,r,o){var n=this.doAjaxWithBody(e,t,s,r,o),i=this
return n.then(function(e,t,s){if(201===s.status)return $.Deferred().resolve(e).promise()
if(202===s.status){var r=$.Deferred(),o=s.getResponseHeader("location")
return o=o+"?force-full-permission="+i.preferences.docPasswordSettings.forceFullPermission,null!=i.documentPassword&&(o=o+"&password="+encodeURIComponent(i.documentPassword)),setTimeout(i.doPoll,i.pollInterval,o,r,i,1),r.promise()}return $.Deferred().reject(s.status,t,s.responseJSON).promise()},function(e,t,s){return $.Deferred().reject(e.status,s,e.responseJSON).promise()})},Gnostice.StarDocs.prototype.doPoll=function(e,t,s,r){return console.log("In doPoll: Polling "+e),s.doAjax("GET",e).then(function(o,n,i){if(200===i.status||201===i.status)console.log("In doPoll: done "+e),t.resolve(o)
else if(202===i.status){if(console.log("In doPoll: output not yet ready "),++r>=s.pollRetryMaxCount)return console.log("In doPoll: Retry count exceeded "),void t.reject(200,"OK",0,"Exceeded poll retry count.")
setTimeout(s.doPoll,s.pollInterval,e,t,s,r)}else console.log("In doPoll: Unexpected status code "+i.status),t.reject(i.status,n,i.responseJSON)},function(e,s,r){return console.log("In doPoll: error textStatus="+s+", errorThrown="+r),t.reject(e.status,r,e.responseJSON)})},Gnostice.StarDocs.prototype.parsePageRangeSettings=function(e){var t={range:""}
if(e.length<1)return t
var s=e.indexOf("|")
if(-1==s)return t.range=e,t
t.range=e.substring(0,s)
var r=e.indexOf("|",s+1)
return-1==r?(t.subRangeMode=e.substring(s+1),t):(t.subRangeMode=e.substring(s+1,r),t.reverseOrder="true"===e.substring(r+1).toLowerCase(),t)},Gnostice.bindInterFrameFunctions=function(e,t){e.bind("submitForm",function(e,s){s=s||{},t.forms.submitForm(s.submitUrl,s.submitMethod,s.includeNoValueFields,s.submitFields,s.isIncludeList).done(function(t,s,r){e.complete(t)}).fail(function(t,s,r){e.error(s,r)}),e.delayReturn(!0)}),e.bind("resetForm",function(e,s){return s=s||{},t.forms.resetForm(s.resetFields,s.isIncludeList)})
var s=function(e){if(null==e)return null
var t={},r=["_formsModule","_widget"]
for(var o in e)if(e.hasOwnProperty(o)&&!r.includes(o))if("radioButtons"===o){t[o]=[]
for(var n=0;n<e[o].length;++n)t[o].push(s(e[o][n]))}else t[o]=e[o]
return t.value=e.getValueAsString(),t}
e.bind("invokeFn",function(e,r){r=r||{}
var o=r.fnName,n=r.params
if("Forms.getFormField"==o){var i=t.forms.getFormField(n.formFieldName)
return s(i)}if("Forms.getAllFormFields"==o){for(var c=t.forms.getAllFormFields(),a={textFormFields:[],radioGroupFormFields:[],comboBoxFormFields:[],listBoxFormFields:[],checkBoxFormFields:[],submitPushButtonFormFields:[],resetPushButtonFormFields:[],simplePushButtonFormFields:[]},u=0;u<c.length;++u){var l=s(c[u])
switch(l.type){case"text":a.textFormFields.push(l)
break
case"radioGroup":a.radioGroupFormFields.push(l)
break
case"comboBox":a.comboBoxFormFields.push(l)
break
case"listBox":a.listBoxFormFields.push(l)
break
case"checkBox":a.checkBoxFormFields.push(l)
break
case"submitPushButton":a.submitPushButtonFormFields.push(l)
break
case"resetPushButton":a.resetPushButtonFormFields.push(l)
break
case"simplePushButton":a.simplePushButtonFormFields.push(l)}}return a}if("Forms.getValueAsString"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i?i.getValueAsString():null}if("Forms.setValueAsString"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i.setValueAsString(n.value),!0)}if("Forms.getRadioButtonSelectedIndex"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&"radioGroup"===i.type?i.getSelectedRadioButtonIndex():null}if("Forms.setRadioButtonSelectedIndex"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.RadioGroupFormField&&(i.setSelectedRadioButtonIndex(n.selectedIndex),!0)}if("Forms.getComboListBoxSelectedItemIndices"==o){var i=t.forms.getFormField(n.formFieldName)
return null==i||"comboBox"!==i.type&&"listBox"!==i.type?null:i.getSelectedItemIndices()}if("Forms.setComboListBoxSelectedItemIndices"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i instanceof gnostice.ComboBoxFormField||i instanceof gnostice.ListBoxFormField)&&(i.setSelectedItemIndices(n.selectedIndices),!0)}if("Forms.setComboBoxValue"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.ComboBoxFormField&&(i.setValue(n.value),!0)}if("Forms.getCheckBoxChecked"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&"checkBox"===i.type?i.getChecked():null}if("Forms.setCheckBoxChecked"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&i instanceof gnostice.CheckBoxFormField&&(i.setChecked(n.checked),!0)}if("Forms.resetForm"==o)return t.forms.resetForm(n.resetFields,n.isIncludeList)
if("Forms.focusForm"==o)return t.forms.focusForm()
if("Forms.setFocus"==o){var i=t.forms.getFormField(n.formFieldName)
return null!=i&&(i.setFocus(),!0)}if("Forms.submitForm"==o){var d=1
null!=n.submitMethod&&"GET"==n.submitMethod.toUpperCase()&&(d=0),t.forms.submitForm(n.submitUrl,d,n.includeNoValueFields,n.submitFields,n.isIncludeList).done(function(t,s,r){e.complete(t,s)}).fail(function(t,s,r){e.error(s,r)}),e.delayReturn(!0)}else if("Forms.addEventListener"==o){console.log("In child frame Forms.addEventListener")
var p=n.eventName,f=n.formFieldSpec,m=n.eventCb
console.log("eventName="+p+", formFieldSpec="+f),null!=p&&null!=m&&t.forms.addEventListener(p,f,function(e){e.hasOwnProperty("viewerManager")&&delete e.viewerManager,e.hasOwnProperty("formField")&&(e.formField=s(e.formField)),m(e)}),e.delayReturn(!0)}else e.error("Unknown function: "+o,"")})}
