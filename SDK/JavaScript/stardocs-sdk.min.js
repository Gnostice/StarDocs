"use strict";(function(){setTimeout(function(arg1){if(arg1==="test"){return}var __nativeST__=window.setTimeout;window.setTimeout=function(vCallback,nDelay){var aArgs=Array.prototype.slice.call(arguments,2);return __nativeST__(vCallback instanceof Function?function(){vCallback.apply(null,aArgs)}:vCallback,nDelay)}},0,"test");var interval=setInterval(function(arg1){clearInterval(interval);if(arg1==="test"){return}var __nativeSI__=window.setInterval;window.setInterval=function(vCallback,nDelay){var aArgs=Array.prototype.slice.call(arguments,2);return __nativeSI__(vCallback instanceof Function?function(){vCallback.apply(null,aArgs)}:vCallback,nDelay)}},0,"test")})();var Gnostice=Gnostice||{};Gnostice.ConnectionInfo=function(apiServerUrl,apiKey,apiSecret,serverTimeout,docOperationTimeout){this.apiServerVersion="2.0.0";this.apiServerUrl=apiServerUrl||"";this.apiKey=apiKey;this.apiSecret=apiSecret;this.serverTimeout=serverTimeout||-1;this.docOperationTimeout=docOperationTimeout||-1};Gnostice.ConnectionInfo.prototype.constructor=Gnostice.ConnectionInfo;Gnostice.DocPasswordSettings=function(forceFullPermission){this.forceFullPermission=forceFullPermission};Gnostice.DocPasswordSettings.prototype=Gnostice.DocPasswordSettings;Gnostice.Preferences=function(docPasswordSettings){this.docPasswordSettings=docPasswordSettings||new Gnostice.DocPasswordSettings(false)};Gnostice.Preferences.prototype.constructor=Gnostice.Preferences;Gnostice.StarDocs=function(connectionInfo,preferences){this.connectionInfo=connectionInfo||new Gnostice.ConnectionInfo;this.preferences=preferences||new Gnostice.Preferences;this.urlSegAuthToken="/auth/token";this.urlSegDocs="/docs";this.urlSegDocsOps="/docs/ops";this.urlSegOps="/ops";this.urlSegInfo="/info";this.urlSegMetaTags="/meta/tags";this.urlSegMetaOwner="/meta/owner";this.urlSegMetaFilename="/meta/filename";this.urlSegUsers="/users";this.urlSegViewSessions="/viewsessions";this.urlSegMiscTags="/misc/tags";this.urlSegMiscGroups="/misc/groups";this.urlMiscPhysicalStores="/misc/physicalstores";this.urlMiscDocumenTreeViews="/misc/documenttreeviews";this.pollInterval=1e3*1;this.pollRetryMaxCount=60*10;this.documentPassword=null;this.setDocumentPassword=function(password){this.documentPassword=password};this.viewSessionId=null;this.setViewSessionId=function(sessionId){this.viewSessionId=sessionId};var Auth=function(starDocs){this.starDocs=starDocs;this.accessToken=null;this.loggedInUserName=null;this.grantType=null};Auth.prototype.constructor=Auth;Auth.prototype.loginUser=function(username,password){this.loggedInUserName=null;this.grantType=null;var authTokenUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken;console.log("In Auth.login: "+username);var self=this;var encodedHeader;if(window.btoa){encodedHeader="Basic "+btoa(self.starDocs.connectionInfo.apiKey+":"+self.starDocs.connectionInfo.apiSecret)}else{encodedHeader="Basic "+jQuery.base64.encode(self.starDocs.connectionInfo.apiKey+":"+self.starDocs.connectionInfo.apiSecret)}var deferred=$.ajax({url:authTokenUrl,type:"POST",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization",encodedHeader)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"password",username:username,password:password}});return deferred.then(function(response,textStatus,jqXhr){if(textStatus=="success"){self.setAccessToken(response.access_token,"password");return $.Deferred().resolve(response).promise()}},function(jqXhr,textStatus,errorThrown){self.setAccessToken(null,null);return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Auth.prototype.loginApp=function(entityId){this.loggedInUserName=null;this.grantType=null;var authTokenUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegAuthToken;if(entityId!=null){authTokenUrl+="?entity_id="+entityId}console.log("In loginApp");var self=this;var encodedHeader;if(window.btoa){encodedHeader="Basic "+btoa(self.starDocs.connectionInfo.apiKey+":"+self.starDocs.connectionInfo.apiSecret)}else{encodedHeader="Basic "+jQuery.base64.encode(self.starDocs.connectionInfo.apiKey+":"+self.starDocs.connectionInfo.apiSecret)}var deferred=$.ajax({url:authTokenUrl,type:"POST",dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("Authorization",encodedHeader)},headers:{"content-type":"application/x-www-form-urlencoded"},data:{grant_type:"client_credentials"}});return deferred.then(function(response,textStatus,jqXhr){if(textStatus=="success"){self.setAccessToken(response.access_token,"client_credentials");return $.Deferred().resolve(response).promise()}},function(jqXhr,textStatus,errorThrown){self.setAccessToken(null,null);return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Auth.prototype.setAccessToken=function(accessToken,grantType){this.accessToken=accessToken;if(grantType!==null){this.grantType=grantType}};var Storage=function(starDocs){this.starDocs=starDocs};Storage.prototype.constructor=Storage;Storage.prototype.upload=function(fileObject,password,uploadFromViewer){console.log("Uploading "+fileObject);var formData=new FormData;formData.append("fileUpload",fileObject);if(password!=null){formData.append("password",password)}formData.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(uploadFromViewer&&this.starDocs.viewSessionId!=null){formData.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)}var docsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs;var self=this;var deferred=this.starDocs.doAjaxWithBody("POST",docsUrl,formData);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.uploadFromURL=function(fileUrl,password,uploadFromViewer){console.log("Uploading "+fileUrl);var formData=new FormData;formData.append("fileURL",fileUrl);if(password!=null){formData.append("password",password)}formData.append("forceFullPermission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(uploadFromViewer&&this.starDocs.viewSessionId!=null){formData.append("viewSessionId",this.starDocs.preferences.docPasswordSettings.forceFullPermission)}var docsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs;var self=this;var deferred=this.starDocs.doAjaxWithBody("POST",docsUrl,formData);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.copyFrom=function(docUrl,password){return this.uploadFromURL(docUrl,password)};Storage.prototype.listFiles=function(whichFiles,includeDetails,queryString){var self=this;var searchClauseList=[];whichFiles="all"||whichFiles;whichFiles=whichFiles.toLowerCase();searchClauseList.push("sub_set="+whichFiles);if($.isArray(queryString)){Array.prototype.push.apply(searchClauseList,queryString)}else if(queryString!=null){searchClauseList.push(queryString)}var includeDetailsStr="";if($.isArray(includeDetails)){includeDetailsStr=includeDetails.join()}else{includeDetailsStr=includeDetails||""}searchClauseList.push("include_details="+includeDetailsStr);var docsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocs;for(var i=0;i<searchClauseList.length;++i){if(i===0){docsUrl+="?"}docsUrl+=searchClauseList[i];if(i<searchClauseList.length){docsUrl+="&"}}var deferred=this.starDocs.doAjax("GET",docsUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.download=function(docUrl,download){console.log("Downloading "+docUrl);if(typeof download!=="boolean"){download=true}if(download){var fileUrl=docUrl;if(this.starDocs.auth.accessToken!==null){fileUrl+="?bearer_token="+this.starDocs.auth.accessToken}console.log("url: "+fileUrl);return $.Deferred().resolve(window.open(fileUrl,"_blank")).promise()}else{var self=this;var deferred=this.starDocs.doAjax("GET",docUrl,"text");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(jqXhr.responseText).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})}};Storage.prototype.getDownloadUrl=function(docUrl){var fileUrl=new URI(docUrl);if(this.starDocs.auth.accessToken!==null){fileUrl=fileUrl.setQuery("bearer_token",this.starDocs.auth.accessToken)}else{return $.Deferred().reject(401,"You need to authenticate before calling this method.").promise()}return $.Deferred().resolve(fileUrl).promise()};Storage.prototype.delete=function(docUrl){console.log("Deleting "+docUrl);var deferred=this.starDocs.doAjax("DELETE",docUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve().promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.setTags=function(docUrl,tags){console.log("Setting tags on  "+docUrl);var self=this;var tagsUrl=docUrl+this.starDocs.urlSegMetaTags;var body=JSON.stringify({tags:tags});var deferred=this.starDocs.doAjaxWithBody("POST",tagsUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve().promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.updateOwner=function(docUrl,newOwnerUserNameEmail,resetSharing,retainRights){console.log("Updating owner for "+docUrl);var docOwnerUrl=docUrl+this.starDocs.urlSegMetaOwner;var req={user:{userNameEmail:newOwnerUserNameEmail}};if(resetSharing!==null){req["resetSharing"]=resetSharing}if(retainRights!==null){req["retainRights"]=retainRights}var body=JSON.stringify(req);var deferred=this.starDocs.doAjaxWithBody("PUT",docOwnerUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve().promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Storage.prototype.rename=function(docUrl,newFilename){console.log("Updating filename for "+docUrl);var docOwnerUrl=docUrl+this.starDocs.urlSegMetaFilename;var req={fileName:newFilename};var body=JSON.stringify(req);var deferred=this.starDocs.doAjaxWithBody("PUT",docOwnerUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){if(textStatus=="success"){return $.Deferred().resolve().promise()}},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};var DocOperations=function(starDocs){this.starDocs=starDocs};DocOperations.prototype.constructor=DocOperations;DocOperations.prototype.merge=function(docUrls,passwords,pageRangeSettings){var docsOpsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/merge";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]};for(var i=0;i<docUrls.length;++i){var jsonDocument={url:docUrls[i]};if(passwords!=null){jsonDocument.password=passwords[i]}if(pageRangeSettings!=null){jsonDocument.pageRange=pageRangeSettings[i]}jsonBody.documents.push(jsonDocument)}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("POST",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.splitRange=function(docUrl,password,pageRangeSettings){var docsOpsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-range";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:docUrl,pageRanges:[]}]};if(password!=null){jsonBody.documents[0].password=passwords}if(pageRangeSettings!=null){jsonBody.documents[0].pageRanges=pageRangeSettings}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("POST",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.splitSeparatorPage=function(docUrl,password){var docsOpsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/split-separator";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:docUrl,separatorType:"emptyPage"}]};if(password!=null){jsonBody.documents[0].password=passwords}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("POST",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.convertToBMP=function(docUrls,passwords,pageRangeSettings,imageEncoderSettings){return this.convertToImage("convert-bmp",docUrls,passwords,pageRangeSettings,imageEncoderSettings)};DocOperations.prototype.convertToGIF=function(docUrls,passwords,pageRangeSettings,imageEncoderSettings){return this.convertToImage("convert-gif",docUrls,passwords,pageRangeSettings,imageEncoderSettings)};DocOperations.prototype.convertToJPEG=function(docUrls,passwords,pageRangeSettings,imageEncoderSettings){return this.convertToImage("convert-jpeg",docUrls,passwords,pageRangeSettings,imageEncoderSettings)};DocOperations.prototype.convertToPNG=function(docUrls,passwords,pageRangeSettings,imageEncoderSettings){return this.convertToImage("convert-png",docUrls,passwords,pageRangeSettings,imageEncoderSettings)};DocOperations.prototype.convertToTIFF=function(docUrls,passwords,pageRangeSettings,imageEncoderSettings,tiffCompressionType){return this.convertToImage("convert-tiff",docUrls,passwords,pageRangeSettings,imageEncoderSettings,tiffCompressionType)};DocOperations.prototype.convertToMTIFF=function(conversionMode,docUrls,passwords,pageRangeSettings,imageEncoderSettings,tiffCompressionType){return this.convertToImage("convert-mtiff",docUrls,passwords,pageRangeSettings,imageEncoderSettings,tiffCompressionType,conversionMode)};DocOperations.prototype.convertToPDF=function(conversionMode,docUrls,passwords,pageRangeSettings,pdfEncoderSettings,digitizerSettings){return this.convertToImage("convert-pdf",docUrls,passwords,pageRangeSettings,null,null,conversionMode,pdfEncoderSettings,digitizerSettings)};DocOperations.prototype.encrypt=function(docUrl,password,encryptionLevel,newOpenPassword,newPermissionsPassword,newPermissions){var docsOpsUrl=docUrl+this.starDocs.urlSegOps+"/encrypt";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission};if(password!=null){jsonBody.password=passwords}if(encryptionLevel!=null){jsonBody.encryptionLevel=encryptionLevel}if(newOpenPassword!=null){jsonBody.newOpenPassword=newOpenPassword}if(newPermissionsPassword!=null){jsonBody.newPermissionsPassword=newPermissionsPassword}if(newPermissions!=null){jsonBody.newPermissions=newPermissions}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("PUT",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.redactText=function(docUrl,password,pageRangeSettings,searchMode,searchText,removeAssociatedAnnotations,fillSettings,includeAdditionalItems,cleanupSettings){var docsOpsUrl=docUrl+this.starDocs.urlSegOps+"/redact-text";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission};if(password!=null){jsonBody.password=passwords}if(pageRangeSettings!=null){jsonBody.pageRange=pageRangeSettings}if(searchMode!=null){jsonBody.searchMode=searchMode}if(searchText!=null){jsonBody.searchText=searchText}if(removeAssociatedAnnotations!=null){jsonBody.removeAssociatedAnnotations=removeAssociatedAnnotations}if(fillSettings!=null){jsonBody.fillSettings=fillSettings}if(includeAdditionalItems!=null){jsonBody.includeAdditionalItems=includeAdditionalItems}if(cleanupSettings!=null){jsonBody.cleanupSettings=cleanupSettings}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("PUT",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.fillForm=function(docUrl,password,fields,flattenAllFields){var docsOpsUrl=docUrl+this.starDocs.urlSegOps+"/fill-form";var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission};if(password!=null){jsonBody.password=password}if(fields!=null){jsonBody.fields=fields}if(flattenAllFields===true){jsonBody.flattenAllFields=flattenAllFields}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("PUT",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.convertToImage=function(urlPart,docUrls,passwords,pageRangeSettings,imageEncoderSettings,tiffCompressionType,conversionMode,pdfEncoderSettings,digitizerSettings){var docsOpsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegDocsOps+"/"+urlPart;var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[]};for(var i=0;i<docUrls.length;++i){var jsonDocument={url:docUrls[i]};if(passwords!=null){jsonDocument.password=passwords[i]}if(pageRangeSettings!=null){jsonDocument.pageRange=pageRangeSettings[i]}jsonBody.documents.push(jsonDocument)}if(imageEncoderSettings!=null){jsonBody.imageEncoderSettings=imageEncoderSettings}if(tiffCompressionType!=null){jsonBody.tiffCompressionType=tiffCompressionType}if(conversionMode!=null){jsonBody.conversionMode=conversionMode}if(pdfEncoderSettings!=null){jsonBody.pdfEncoderSettings=pdfEncoderSettings}if(digitizerSettings!=null){jsonBody.digitizerSettings=digitizerSettings}var body=JSON.stringify(jsonBody);return this.starDocs.doAjaxWithBodyAndPoll("POST",docsOpsUrl,body,"application/json; charset=utf-8")};DocOperations.prototype.getDocInfo=function(docUrl,password){var docInfoUrl=new URI(docUrl).segment(this.starDocs.urlSegInfo).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(password!=null){docInfoUrl=docInfoUrl.setQuery("password",password)}else if(this.starDocs.documentPassword!=null){docInfoUrl=docInfoUrl.setQuery("password",this.starDocs.documentPassword)}return this.starDocs.doAjaxAndPoll("GET",docInfoUrl.toString())};DocOperations.prototype.getPageImage=function(pageUrl,renderingSettings,password){renderingSettings=renderingSettings||{};var pageUrlObj=new URI(pageUrl).setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(renderingSettings.dpi!=null){pageUrlObj=pageUrlObj.setQuery("dpi",renderingSettings.dpi)}if(renderingSettings.renderFormFields!=null){pageUrlObj=pageUrlObj.setQuery("render-form-fields",renderingSettings.renderFormFields)}if(password!=null){pageUrlObj=pageUrlObj.setQuery("password",password)}else if(this.starDocs.documentPassword!=null){pageUrlObj=pageUrlObj.setQuery("password",this.starDocs.documentPassword)}return this.starDocs.doAjaxAndPoll("GET",pageUrlObj.toString())};DocOperations.prototype.getDocumentPrintImageURLs=function(docUrl,password){var docOpsUrl=new URI(docUrl).segment(this.starDocs.urlSegOps).segment("prepare-print-images");var jsonBody={forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission};if(password!=null){jsonBody.password=passwords}else if(this.starDocs.documentPassword!=null){jsonBody.password=this.starDocs.documentPassword}var body=JSON.stringify(jsonBody);var returnDeferred=$.Deferred();var that=this;this.starDocs.doAjaxWithBodyAndPoll("POST",docOpsUrl.toString(),body,"application/json; charset=utf-8").done(function(response){console.log("In getDocumentPrintImageURLs: Pages ready "+response);var pageImageUrls=[];var largestRenderedPageCount=response.largestRenderedPageCount;var pagesUrl=new URI(docUrl).segment("pages");for(var pageNum=1;pageNum<=largestRenderedPageCount;++pageNum){var pageImageUrl=pagesUrl.toString()+"/"+pageNum+"/image";var pageImageDownloadUrl=new URI(pageImageUrl).setQuery("bearer_token",that.starDocs.auth.accessToken).toString();pageImageUrls.push(pageImageDownloadUrl)}returnDeferred.resolve(pageImageUrls)}).fail(function(status,errorThrown,response){console.log("In getDocumentPrintImageURLs: fail event called");returnDeferred.reject(status,errorThrown,response)});return returnDeferred.promise()};DocOperations.prototype.getPageFormFields=function(pageUrl,password){var pageFormFieldsUrl=new URI(pageUrl).segment("formfields").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(password!=null){pageFormFieldsUrl=pageFormFieldsUrl.setQuery("password",password)}else if(this.starDocs.documentPassword!=null){pageFormFieldsUrl=pageFormFieldsUrl.setQuery("password",this.starDocs.documentPassword)}return this.starDocs.doAjaxAndPoll("GET",pageFormFieldsUrl.toString())};DocOperations.prototype.getPageText=function(pageUrl,password){var pageTextUrl=new URI(pageUrl).segment("text").setQuery("force-full-permission",this.starDocs.preferences.docPasswordSettings.forceFullPermission);if(password!=null){pageTextUrl=pageTextUrl.setQuery("password",password)}else if(this.starDocs.documentPassword!=null){pageTextUrl=pageTextUrl.setQuery("password",this.starDocs.documentPassword)}return this.starDocs.doAjaxAndPoll("GET",pageTextUrl.toString())};var UserMgmt=function(starDocs){this.starDocs=starDocs};UserMgmt.prototype.constructor=UserMgmt;UserMgmt.prototype.listUsers=function(){var usersUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers;var deferred=this.starDocs.doAjax("GET",usersUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};UserMgmt.prototype.getUserDetails=function(userUrl){userUrl=userUrl||this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegUsers+"/me";var deferred=this.starDocs.doAjax("GET",userUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};var Viewer=function(starDocs){this.starDocs=starDocs};Viewer.prototype.constructor=Viewer;Viewer.prototype.createView=function(docUrl,password,viewerSettings){console.log("Creating viewer for doc "+docUrl);var self=this;var viewSessionsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegViewSessions;viewerSettings=viewerSettings||{};password=password||"";var body=JSON.stringify({forceFullPermission:this.starDocs.preferences.docPasswordSettings.forceFullPermission,documents:[{url:docUrl,password:password}],viewerSettings:viewerSettings});var deferred=this.starDocs.doAjaxWithBody("POST",viewSessionsUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};var Misc=function(starDocs){this.starDocs=starDocs};Misc.prototype.constructor=Misc;Misc.prototype.getLookupTags=function(){var tagsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscTags;var deferred=this.starDocs.doAjax("GET",tagsUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.listGroups=function(){var groupsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlSegMiscGroups;var deferred=this.starDocs.doAjax("GET",groupsUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.listPhysicalStores=function(){var physicalStoresUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscPhysicalStores;var deferred=this.starDocs.doAjax("GET",physicalStoresUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.listDocumentTreeViews=function(){var documentTreeViewsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews;var deferred=this.starDocs.doAjax("GET",documentTreeViewsUrl);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.createDocumentTreeView=function(name,tags){var documentTreeViewsUrl=this.starDocs.connectionInfo.apiServerUrl+this.starDocs.urlMiscDocumenTreeViews;var body=JSON.stringify({documentTreeView:{name:name,tagKeys:tags}});var deferred=this.starDocs.doAjaxWithBody("POST",documentTreeViewsUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve(response).promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.editDocumentTreeView=function(documentTreeViewsUrl,name,tags){var body=JSON.stringify({documentTreeView:{name:name,tagKeys:tags}});var deferred=this.starDocs.doAjaxWithBody("PUT",documentTreeViewsUrl,body,"application/json; charset=utf-8");return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve().promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Misc.prototype.deleteDocumentTreeView=function(url){console.log("Deleting "+url);var deferred=this.starDocs.doAjax("DELETE",url);return deferred.then(function(response,textStatus,jqXhr){return $.Deferred().resolve().promise()},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};this.auth=new Auth(this);this.storage=new Storage(this);this.docOperations=new DocOperations(this);this.userMgmt=new UserMgmt(this);this.viewer=new Viewer(this);this.misc=new Misc(this)};Gnostice.StarDocs.prototype.constructor=Gnostice.StarDocs;Gnostice.StarDocs.prototype.assertUserLogin=function(){if(this.auth.accessToken===null){throw new Error("Authentication required")}};Gnostice.StarDocs.prototype.doAjax=function(method,url,expectedDataType){var self=this;return $.ajax({url:url,type:method,dataType:expectedDataType||"json",beforeSend:function(xhr){if(self.auth.grantType!==null&&self.auth.accessToken!==null){xhr.setRequestHeader("Authorization","Bearer "+self.auth.accessToken)}},contentType:false,cache:false,processData:false})};Gnostice.StarDocs.prototype.doAjaxWithBody=function(method,url,body,bodyContentType,expectedDataType){var self=this;return $.ajax({url:url,type:method,dataType:expectedDataType||"json",beforeSend:function(xhr){if(self.auth.grantType!==null&&self.auth.accessToken!==null){xhr.setRequestHeader("Authorization","Bearer "+self.auth.accessToken)}},data:body,contentType:bodyContentType||false,cache:false,processData:false})};Gnostice.StarDocs.prototype.doAjaxAndPoll=function(method,url,expectedDataType){var deferred=this.doAjax(method,url,expectedDataType);var that=this;return deferred.then(function(response,textStatus,jqXhr){if(jqXhr.status===200){return $.Deferred().resolve(response).promise()}else if(jqXhr.status===202){var newDeferred=$.Deferred();var pollUrl=new URI(jqXhr.getResponseHeader("location"));if(that.preferences.docPasswordSettings.forceFullPermission){pollUrl=pollUrl.setQuery("force-full-permission",true)}if(that.documentPassword!=null){pollUrl=pollUrl.setQuery("password",that.documentPassword)}setTimeout(that.doPoll,that.pollInterval,pollUrl.toString(),newDeferred,that,1);return newDeferred.promise()}else{return $.Deferred().reject(jqXhr.status,textStatus,jqXhr.responseJSON).promise()}},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Gnostice.StarDocs.prototype.doAjaxWithBodyAndPoll=function(method,url,body,bodyContentType,expectedDataType){var deferred=this.doAjaxWithBody(method,url,body,bodyContentType,expectedDataType);var that=this;return deferred.then(function(response,textStatus,jqXhr){if(jqXhr.status===201){return $.Deferred().resolve(response).promise()}else if(jqXhr.status===202){var newDeferred=$.Deferred();var pollUrl=jqXhr.getResponseHeader("location");pollUrl=pollUrl+"?force-full-permission="+that.preferences.docPasswordSettings.forceFullPermission;if(that.documentPassword!=null){pollUrl=pollUrl+"&password="+encodeURIComponent(that.documentPassword)}setTimeout(that.doPoll,that.pollInterval,pollUrl,newDeferred,that,1);return newDeferred.promise()}else{return $.Deferred().reject(jqXhr.status,textStatus,jqXhr.responseJSON).promise()}},function(jqXhr,textStatus,errorThrown){return $.Deferred().reject(jqXhr.status,errorThrown,jqXhr.responseJSON).promise()})};Gnostice.StarDocs.prototype.doPoll=function(pollUrl,deferred,starDocs,pollRetryCount){console.log("In doPoll: Polling "+pollUrl);var deferredRequest=starDocs.doAjax("GET",pollUrl);return deferredRequest.then(function(response,textStatus,jqXhr){if(jqXhr.status===200||jqXhr.status===201){console.log("In doPoll: done "+pollUrl);deferred.resolve(response)}else if(jqXhr.status===202){console.log("In doPoll: output not yet ready ");++pollRetryCount;if(pollRetryCount>=starDocs.pollRetryMaxCount){console.log("In doPoll: Retry count exceeded ");deferred.reject(200,"OK",0,"Exceeded poll retry count.");return}setTimeout(starDocs.doPoll,starDocs.pollInterval,pollUrl,deferred,starDocs,pollRetryCount)}else{console.log("In doPoll: Unexpected status code "+jqXhr.status);deferred.reject(jqXhr.status,textStatus,jqXhr.responseJSON)}},function(jqXhr,textStatus,errorThrown){console.log("In doPoll: error textStatus="+textStatus+", errorThrown="+errorThrown);return deferred.reject(jqXhr.status,errorThrown,jqXhr.responseJSON)})};Gnostice.StarDocs.prototype.parsePageRangeSettings=function(pageRangeSetting){var ret={range:""};if(pageRangeSetting.length<1){return ret}var tpos=pageRangeSetting.indexOf("|");if(tpos==-1){ret["range"]=pageRangeSetting;return ret}ret["range"]=pageRangeSetting.substring(0,tpos);var tpos1=pageRangeSetting.indexOf("|",tpos+1);if(tpos1==-1){ret["subRangeMode"]=pageRangeSetting.substring(tpos+1);return ret}ret["subRangeMode"]=pageRangeSetting.substring(tpos+1,tpos1);ret["reverseOrder"]=pageRangeSetting.substring(tpos1+1).toLowerCase()==="true";return ret};